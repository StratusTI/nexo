generator client {
  provider      = "prisma-client-js"
  output        = "../../src/generated/elo"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_ELO_URL")
}

model Projeto {
  id               Int                @id @default(autoincrement())
  nome             String             @db.VarChar(255)
  descricao        String?            @db.Text
  cor              String?            @default("#6366f1") @db.VarChar(7)
  dataInicio       DateTime?          @map("data_inicio") @db.Date
  dataFim          DateTime?          @map("data_fim") @db.Date
  ownerId          Int                @map("owner_id")
  status           ProjetoStatus?     @default(ativo)
  createdAt        DateTime?          @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt        DateTime?          @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  atividades       Atividade[]
  capacidadeTime   CapacidadeTime[]
  colunas          Coluna[]
  definitionOfDone DefinitionOfDone[]
  documentos       Documento[]
  piObjectives     PiObjective[]
  arts             ProjetoArt[]
  membros          ProjetoMembro[]
  riscos           Risco[]
  sprints          Sprint[]
  tags             Tag[]
  tarefas          Tarefa[]
  userStories      UserStory[]

  @@index([ownerId], map: "idx_owner")
  @@index([status], map: "idx_status")
  @@map("projetos")
}

model ProjetoMembro {
  id           Int                @id @default(autoincrement())
  projetoId    Int                @map("projeto_id")
  usuarioId    Int                @map("usuario_id")
  role         ProjetoMemberRole? @default(member)
  adicionadoEm DateTime?          @default(now()) @map("adicionado_em") @db.DateTime(0)
  projeto      Projeto            @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pm_projeto")

  @@unique([projetoId, usuarioId], map: "uniq_projeto_usuario")
  @@index([projetoId], map: "idx_projeto")
  @@index([usuarioId], map: "idx_usuario")
  @@map("projeto_membros")
}

model Coluna {
  id        Int       @id @default(autoincrement())
  titulo    String    @db.VarChar(100)
  ordem     Int       @default(0)
  cor       String?   @default("#cccccc") @db.VarChar(7)
  projetoId Int       @map("projeto_id")
  createdAt DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  projeto   Projeto   @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_coluna_projeto")
  tarefas   Tarefa[]

  @@index([projetoId], map: "idx_projeto")
  @@index([ordem], map: "idx_ordem")
  @@map("colunas")
}

model Tarefa {
  id                Int                 @id @default(autoincrement())
  titulo            String              @db.VarChar(255)
  descricao         String?             @db.Text
  prazo             DateTime?           @db.Date
  prioridade        TarefaPrioridade?   @default(media)
  ordem             Int                 @default(0)
  estimativaHoras   Decimal?            @map("estimativa_horas") @db.Decimal(8, 2)
  horasRealizadas   Decimal?            @map("horas_realizadas") @db.Decimal(8, 2)
  dataInicioReal    DateTime?           @map("data_inicio_real") @db.DateTime(0)
  dataConclusaoReal DateTime?           @map("data_conclusao_real") @db.DateTime(0)
  colunaId          Int                 @map("coluna_id")
  projetoId         Int                 @map("projeto_id")
  userStoryId       Int?                @map("user_story_id")
  createdBy         Int                 @map("created_by")
  createdAt         DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt         DateTime?           @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  anexos            Anexo[]
  comentarios       Comentario[]
  subtarefas        Subtarefa[]
  responsaveis      TarefaResponsavel[]
  tags              TarefaTag[]
  coluna            Coluna              @relation(fields: [colunaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tarefa_coluna")
  projeto           Projeto             @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tarefa_projeto")
  userStory         UserStory?          @relation(fields: [userStoryId], references: [id], onUpdate: Restrict, map: "fk_tarefa_story")

  @@index([colunaId], map: "idx_coluna")
  @@index([projetoId], map: "idx_projeto")
  @@index([userStoryId], map: "idx_story")
  @@index([prazo], map: "idx_prazo")
  @@index([createdBy], map: "idx_created_by")
  @@index([projetoId, colunaId], map: "idx_projeto_coluna")
  @@index([prazo, prioridade], map: "idx_prazo_prioridade")
  @@map("tarefas")
}

model TarefaResponsavel {
  id          Int       @id @default(autoincrement())
  tarefaId    Int       @map("tarefa_id")
  usuarioId   Int       @map("usuario_id")
  atribuidoEm DateTime? @default(now()) @map("atribuido_em") @db.DateTime(0)
  tarefa      Tarefa    @relation(fields: [tarefaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tr_tarefa")

  @@unique([tarefaId, usuarioId], map: "uniq_tarefa_usuario")
  @@index([tarefaId], map: "idx_tarefa")
  @@index([usuarioId], map: "idx_usuario")
  @@map("tarefa_responsaveis")
}

model Subtarefa {
  id        Int       @id @default(autoincrement())
  titulo    String    @db.VarChar(255)
  concluida Boolean?  @default(false)
  ordem     Int       @default(0)
  tarefaId  Int       @map("tarefa_id")
  createdAt DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  tarefa    Tarefa    @relation(fields: [tarefaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_subtarefa_tarefa")

  @@index([tarefaId], map: "idx_tarefa")
  @@index([ordem], map: "idx_ordem")
  @@map("subtarefas")
}

model Tag {
  id        Int         @id @default(autoincrement())
  nome      String      @db.VarChar(50)
  cor       String?     @default("#3b82f6") @db.VarChar(7)
  projetoId Int         @map("projeto_id")
  createdAt DateTime?   @default(now()) @map("created_at") @db.DateTime(0)
  projeto   Projeto     @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tag_projeto")
  tarefas   TarefaTag[]

  @@index([projetoId], map: "idx_projeto")
  @@map("tags")
}

model TarefaTag {
  id       Int    @id @default(autoincrement())
  tarefaId Int    @map("tarefa_id")
  tagId    Int    @map("tag_id")
  tag      Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tt_tag")
  tarefa   Tarefa @relation(fields: [tarefaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tt_tarefa")

  @@unique([tarefaId, tagId], map: "uniq_tarefa_tag")
  @@index([tarefaId], map: "idx_tarefa")
  @@index([tagId], map: "idx_tag")
  @@map("tarefa_tags")
}

model Comentario {
  id        Int          @id @default(autoincrement())
  texto     String       @db.Text
  tarefaId  Int          @map("tarefa_id")
  usuarioId Int          @map("usuario_id")
  parentId  Int?         @map("parent_id")
  createdAt DateTime?    @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt DateTime?    @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  parent    Comentario?  @relation("ComentarioReplies", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_comentario_parent")
  respostas Comentario[] @relation("ComentarioReplies")
  tarefa    Tarefa       @relation(fields: [tarefaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_comentario_tarefa")

  @@index([tarefaId], map: "idx_tarefa")
  @@index([usuarioId], map: "idx_usuario")
  @@index([parentId], map: "idx_parent")
  @@index([createdAt], map: "idx_created")
  @@map("comentarios")
}

model Anexo {
  id        Int       @id @default(autoincrement())
  nome      String    @db.VarChar(255)
  url       String    @db.VarChar(500)
  tipo      String?   @db.VarChar(50)
  tamanho   BigInt?
  tarefaId  Int       @map("tarefa_id")
  usuarioId Int       @map("usuario_id")
  createdAt DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  tarefa    Tarefa    @relation(fields: [tarefaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_anexo_tarefa")

  @@index([tarefaId], map: "idx_tarefa")
  @@index([usuarioId], map: "idx_usuario")
  @@map("anexos")
}

model UserStory {
  id                 Int                 @id @default(autoincrement())
  titulo             String              @db.VarChar(255)
  persona            String?             @db.VarChar(100)
  acao               String?             @db.Text
  beneficio          String?             @db.Text
  criteriosAceitacao String?             @map("criterios_aceitacao") @db.Text
  storyPoints        Decimal?            @map("story_points") @db.Decimal(5, 2)
  estimativaHoras    Decimal?            @map("estimativa_horas") @db.Decimal(8, 2)
  horasRealizadas    Decimal?            @map("horas_realizadas") @db.Decimal(8, 2)
  prioridade         Int?                @default(0)
  status             UserStoryStatus?    @default(backlog)
  projetoId          Int                 @map("projeto_id")
  sprintId           Int?                @map("sprint_id")
  featureId          Int?                @map("feature_id")
  createdAt          DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt          DateTime?           @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  dodChecklist       StoryDodChecklist[]
  tarefas            Tarefa[]
  feature            Feature?            @relation(fields: [featureId], references: [id], onUpdate: Restrict, map: "fk_story_feature")
  projeto            Projeto             @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_story_projeto")
  sprint             Sprint?             @relation(fields: [sprintId], references: [id], onUpdate: Restrict, map: "fk_story_sprint")

  @@index([projetoId], map: "idx_projeto")
  @@index([sprintId], map: "idx_sprint")
  @@index([featureId], map: "idx_feature")
  @@index([status], map: "idx_status")
  @@map("user_stories")
}

model Sprint {
  id                  Int              @id @default(autoincrement())
  nome                String           @db.VarChar(100)
  objetivo            String?          @db.Text
  dataInicio          DateTime         @map("data_inicio") @db.Date
  dataFim             DateTime         @map("data_fim") @db.Date
  capacidadePlanejada Decimal?         @map("capacidade_planejada") @db.Decimal(10, 2)
  capacidadeRealizada Decimal?         @map("capacidade_realizada") @db.Decimal(10, 2)
  velocidade          Decimal?         @db.Decimal(10, 2)
  status              SprintStatus?    @default(planejamento)
  projetoId           Int              @map("projeto_id")
  createdAt           DateTime?        @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt           DateTime?        @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  capacidadeTime      CapacidadeTime[]
  retrospectivas      Retrospectiva[]
  metricas            SprintMetrica[]
  projeto             Projeto          @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_sprint_projeto")
  userStories         UserStory[]

  @@index([projetoId], map: "idx_projeto")
  @@index([status], map: "idx_status")
  @@index([dataInicio, dataFim], map: "idx_datas")
  @@map("sprints")
}

model SprintMetrica {
  id                   Int       @id @default(autoincrement())
  sprintId             Int       @map("sprint_id")
  data                 DateTime  @db.Date
  storyPointsRestantes Decimal?  @map("story_points_restantes") @db.Decimal(10, 2)
  horasRestantes       Decimal?  @map("horas_restantes") @db.Decimal(10, 2)
  tarefasConcluidas    Int?      @default(0) @map("tarefas_concluidas")
  tarefasEmProgresso   Int?      @default(0) @map("tarefas_em_progresso")
  tarefasBloqueadas    Int?      @default(0) @map("tarefas_bloqueadas")
  observacoes          String?   @db.Text
  createdAt            DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  sprint               Sprint    @relation(fields: [sprintId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_metrica_sprint")

  @@unique([sprintId, data], map: "uniq_sprint_data")
  @@index([sprintId], map: "idx_sprint")
  @@index([data], map: "idx_data")
  @@map("sprint_metricas")
}

model DefinitionOfDone {
  id             Int                 @id @default(autoincrement())
  titulo         String              @db.VarChar(255)
  descricao      String?             @db.Text
  ordem          Int                 @default(0)
  obrigatorio    Boolean?            @default(true)
  projetoId      Int                 @map("projeto_id")
  nivel          DodNivel?           @default(story)
  createdAt      DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt      DateTime?           @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  projeto        Projeto             @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_dod_projeto")
  storyChecklist StoryDodChecklist[]

  @@index([projetoId], map: "idx_projeto")
  @@index([nivel], map: "idx_nivel")
  @@map("definition_of_done")
}

model StoryDodChecklist {
  id            Int              @id @default(autoincrement())
  storyId       Int              @map("story_id")
  dodId         Int              @map("dod_id")
  concluido     Boolean?         @default(false)
  verificadoPor Int?             @map("verificado_por")
  verificadoEm  DateTime?        @map("verificado_em") @db.DateTime(0)
  observacoes   String?          @db.Text
  dod           DefinitionOfDone @relation(fields: [dodId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_story_dod_dod")
  story         UserStory        @relation(fields: [storyId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_story_dod_story")

  @@unique([storyId, dodId], map: "uniq_story_dod")
  @@index([storyId], map: "idx_story")
  @@index([dodId], map: "idx_dod")
  @@map("story_dod_checklist")
}

model CapacidadeTime {
  id                     Int               @id @default(autoincrement())
  projetoId              Int               @map("projeto_id")
  usuarioId              Int               @map("usuario_id")
  sprintId               Int?              @map("sprint_id")
  piId                   Int?              @map("pi_id")
  capacidadeTotalHoras   Decimal           @map("capacidade_total_horas") @db.Decimal(8, 2)
  capacidadePlanejadaSp  Decimal?          @map("capacidade_planejada_sp") @db.Decimal(8, 2)
  ausenciasHoras         Decimal?          @default(0.00) @map("ausencias_horas") @db.Decimal(8, 2)
  trabalhoOutrosProjetos Decimal?          @default(0.00) @map("trabalho_outros_projetos") @db.Decimal(8, 2)
  capacidadeLiquida      Decimal?          @map("capacidade_liquida") @db.Decimal(8, 2)
  createdAt              DateTime?         @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt              DateTime?         @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  pi                     ProgramIncrement? @relation(fields: [piId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_cap_pi")
  projeto                Projeto           @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_cap_projeto")
  sprint                 Sprint?           @relation(fields: [sprintId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_cap_sprint")

  @@index([projetoId], map: "idx_projeto")
  @@index([usuarioId], map: "idx_usuario")
  @@index([sprintId], map: "idx_sprint")
  @@index([piId], map: "idx_pi")
  @@map("capacidade_time")
}

model Retrospectiva {
  id            Int                  @id @default(autoincrement())
  sprintId      Int                  @map("sprint_id")
  dataReuniao   DateTime             @map("data_reuniao") @db.DateTime(0)
  facilitadorId Int?                 @map("facilitador_id")
  formato       String?              @default("start-stop-continue") @db.VarChar(100)
  status        RetrospectivaStatus? @default(agendada)
  notasGerais   String?              @map("notas_gerais") @db.Text
  createdAt     DateTime?            @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt     DateTime?            @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  acoes         RetrospectivaAcao[]
  itens         RetrospectivaItem[]
  sprint        Sprint               @relation(fields: [sprintId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_retro_sprint")

  @@index([sprintId], map: "idx_sprint")
  @@map("retrospectivas")
}

model RetrospectivaItem {
  id              Int                    @id @default(autoincrement())
  retrospectivaId Int                    @map("retrospectiva_id")
  categoria       RetrospectivaCategoria
  descricao       String                 @db.Text
  autorId         Int?                   @map("autor_id")
  votos           Int?                   @default(0)
  actionItem      Boolean?               @default(false) @map("action_item")
  createdAt       DateTime?              @default(now()) @map("created_at") @db.DateTime(0)
  acoes           RetrospectivaAcao[]
  retrospectiva   Retrospectiva          @relation(fields: [retrospectivaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_retro_item")

  @@index([retrospectivaId], map: "idx_retrospectiva")
  @@index([categoria], map: "idx_categoria")
  @@map("retrospectiva_itens")
}

model RetrospectivaAcao {
  id              Int                      @id @default(autoincrement())
  retrospectivaId Int                      @map("retrospectiva_id")
  itemId          Int?                     @map("item_id")
  descricao       String                   @db.Text
  responsavelId   Int?                     @map("responsavel_id")
  prazo           DateTime?                @db.Date
  status          RetrospectivaAcaoStatus? @default(pendente)
  createdAt       DateTime?                @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt       DateTime?                @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  retrospectiva   Retrospectiva            @relation(fields: [retrospectivaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_retro_acao")
  item            RetrospectivaItem?       @relation(fields: [itemId], references: [id], onUpdate: Restrict, map: "fk_retro_acao_item")

  @@index([retrospectivaId], map: "idx_retrospectiva")
  @@index([responsavelId], map: "idx_responsavel")
  @@index([status], map: "idx_status")
  @@index([itemId], map: "fk_retro_acao_item")
  @@map("retrospectiva_acoes")
}

model Art {
  id                Int                @id @default(autoincrement())
  nome              String             @db.VarChar(100)
  descricao         String?            @db.Text
  valueStream       String?            @map("value_stream") @db.VarChar(100)
  rteId             Int?               @map("rte_id")
  cadenciaPi        Int?               @default(12) @map("cadencia_pi")
  status            ArtStatus?         @default(ativo)
  createdAt         DateTime?          @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt         DateTime?          @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  epics             Epic[]
  programIncrements ProgramIncrement[]
  projetos          ProjetoArt[]
  roadmaps          Roadmap[]

  @@index([rteId], map: "idx_rte")
  @@index([status], map: "idx_status")
  @@map("arts")
}

model ProjetoArt {
  id           Int       @id @default(autoincrement())
  projetoId    Int       @map("projeto_id")
  artId        Int       @map("art_id")
  adicionadoEm DateTime? @default(now()) @map("adicionado_em") @db.DateTime(0)
  art          Art       @relation(fields: [artId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pa_art")
  projeto      Projeto   @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pa_projeto")

  @@unique([projetoId, artId], map: "uniq_projeto_art")
  @@index([projetoId], map: "idx_projeto")
  @@index([artId], map: "idx_art")
  @@map("projeto_art")
}

model ProgramIncrement {
  id                 Int              @id @default(autoincrement())
  nome               String           @db.VarChar(100)
  artId              Int              @map("art_id")
  dataInicio         DateTime         @map("data_inicio") @db.Date
  dataFim            DateTime         @map("data_fim") @db.Date
  dataPlanning       DateTime?        @map("data_planning") @db.Date
  objetivoPi         String?          @map("objetivo_pi") @db.Text
  tema               String?          @db.VarChar(255)
  status             PiStatus?        @default(planejamento)
  businessContext    String?          @map("business_context") @db.Text
  architectureVision String?          @map("architecture_vision") @db.Text
  createdAt          DateTime?        @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt          DateTime?        @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  capacidadeTime     CapacidadeTime[]
  dependencias       Dependencia[]
  epics              Epic[]
  features           Feature[]
  inspectAdapt       InspectAdapt[]
  ipIterations       IpIteration[]
  piObjectives       PiObjective[]
  art                Art              @relation(fields: [artId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pi_art")
  riscos             Risco[]
  roadmapItensFim    RoadmapItem[]    @relation("RoadmapItemFim")
  roadmapItensInicio RoadmapItem[]    @relation("RoadmapItemInicio")

  @@index([artId], map: "idx_art")
  @@index([status], map: "idx_status")
  @@index([dataInicio, dataFim], map: "idx_datas")
  @@map("program_increments")
}

model PiObjective {
  id                   Int                  @id @default(autoincrement())
  piId                 Int                  @map("pi_id")
  projetoId            Int                  @map("projeto_id")
  descricao            String               @db.Text
  businessValue        Int?                 @default(0) @map("business_value")
  probabilidadeSucesso Decimal?             @map("probabilidade_sucesso") @db.Decimal(5, 2)
  tipo                 PiObjectiveType?     @default(committed)
  stretch              Boolean?             @default(false)
  status               PiObjectiveStatus?   @default(planned)
  resultadoFinal       String?              @map("resultado_final") @db.Text
  createdAt            DateTime?            @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt            DateTime?            @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  features             PiObjectiveFeature[]
  pi                   ProgramIncrement     @relation(fields: [piId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pio_pi")
  projeto              Projeto              @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_pio_projeto")

  @@index([piId], map: "idx_pi")
  @@index([projetoId], map: "idx_projeto")
  @@index([tipo], map: "idx_tipo")
  @@map("pi_objectives")
}

model PiObjectiveFeature {
  id            Int         @id @default(autoincrement())
  piObjectiveId Int         @map("pi_objective_id")
  featureId     Int         @map("feature_id")
  feature       Feature     @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_piof_feature")
  piObjective   PiObjective @relation(fields: [piObjectiveId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_piof_pio")

  @@unique([piObjectiveId, featureId], map: "uniq_pio_feature")
  @@index([piObjectiveId], map: "idx_pio")
  @@index([featureId], map: "idx_feature")
  @@map("pi_objective_features")
}

model IpIteration {
  id             Int              @id @default(autoincrement())
  piId           Int              @map("pi_id")
  dataInicio     DateTime         @map("data_inicio") @db.Date
  dataFim        DateTime         @map("data_fim") @db.Date
  objetivo       String?          @db.Text
  tipoAtividades String?          @default("innovation") @map("tipo_atividades")
  createdAt      DateTime?        @default(now()) @map("created_at") @db.DateTime(0)
  pi             ProgramIncrement @relation(fields: [piId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ip_pi")

  @@index([piId], map: "idx_pi")
  @@map("ip_iterations")
}

model InspectAdapt {
  id                   Int                 @id @default(autoincrement())
  piId                 Int                 @map("pi_id")
  dataReuniao          DateTime            @map("data_reuniao") @db.DateTime(0)
  facilitadorId        Int?                @map("facilitador_id")
  piPerformanceMetrics String?             @map("pi_performance_metrics") @db.LongText
  notasGerais          String?             @map("notas_gerais") @db.Text
  status               InspectAdaptStatus? @default(agendada)
  createdAt            DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt            DateTime?           @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  problemas            IaProblema[]
  pi                   ProgramIncrement    @relation(fields: [piId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ia_pi")

  @@index([piId], map: "idx_pi")
  @@map("inspect_adapt")
}

model IaProblema {
  id                Int                @id @default(autoincrement())
  inspectAdaptId    Int                @map("inspect_adapt_id")
  problema          String             @db.Text
  impacto           String?            @db.Text
  votos             Int?               @default(0)
  categoriaFishbone FishboneCategoria? @map("categoria_fishbone")
  causaRaiz         String?            @map("causa_raiz") @db.Text
  createdAt         DateTime?          @default(now()) @map("created_at") @db.DateTime(0)
  acoes             IaAcao[]
  inspectAdapt      InspectAdapt       @relation(fields: [inspectAdaptId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_iap_ia")

  @@index([inspectAdaptId], map: "idx_ia")
  @@map("ia_problemas")
}

model IaAcao {
  id            Int           @id @default(autoincrement())
  problemaId    Int           @map("problema_id")
  descricao     String        @db.Text
  responsavelId Int?          @map("responsavel_id")
  prazo         DateTime?     @db.Date
  status        IaAcaoStatus? @default(pendente)
  createdAt     DateTime?     @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt     DateTime?     @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  problema      IaProblema    @relation(fields: [problemaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_iaa_problema")

  @@index([problemaId], map: "idx_problema")
  @@index([status], map: "idx_status")
  @@map("ia_acoes")
}

model Epic {
  id                  Int               @id @default(autoincrement())
  titulo              String            @db.VarChar(255)
  descricao           String?           @db.Text
  hypothesisStatement String?           @map("hypothesis_statement") @db.Text
  businessOutcome     String?           @map("business_outcome") @db.Text
  leadingIndicators   String?           @map("leading_indicators") @db.Text
  tipo                EpicType?         @default(business)
  status              EpicStatus?       @default(funnel)
  wsjfScore           Decimal?          @map("wsjf_score") @db.Decimal(10, 2)
  valorNegocio        Int?              @default(0) @map("valor_negocio")
  reducaoRisco        Int?              @default(0) @map("reducao_risco")
  oportunidadeTempo   Int?              @default(0) @map("oportunidade_tempo")
  tamanhoJob          Int?              @default(0) @map("tamanho_job")
  ownerId             Int?              @map("owner_id")
  artId               Int?              @map("art_id")
  piTarget            Int?              @map("pi_target")
  parentEpicId        Int?              @map("parent_epic_id")
  createdAt           DateTime?         @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt           DateTime?         @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  art                 Art?              @relation(fields: [artId], references: [id], onUpdate: Restrict, map: "fk_epic_art")
  parentEpic          Epic?             @relation("EpicHierarchy", fields: [parentEpicId], references: [id], onUpdate: Restrict, map: "fk_epic_parent")
  childEpics          Epic[]            @relation("EpicHierarchy")
  pi                  ProgramIncrement? @relation(fields: [piTarget], references: [id], onUpdate: Restrict, map: "fk_epic_pi")
  features            Feature[]
  roadmapItens        RoadmapItem[]

  @@index([artId], map: "idx_art")
  @@index([status], map: "idx_status")
  @@index([piTarget], map: "idx_pi_target")
  @@index([parentEpicId], map: "idx_parent")
  @@map("epics")
}

model Feature {
  id                 Int                  @id @default(autoincrement())
  titulo             String               @db.VarChar(255)
  descricao          String?              @db.Text
  benefitHypothesis  String?              @map("benefit_hypothesis") @db.Text
  acceptanceCriteria String?              @map("acceptance_criteria") @db.Text
  epicId             Int?                 @map("epic_id")
  piId               Int                  @map("pi_id")
  status             FeatureStatus?       @default(backlog)
  wsjfScore          Decimal?             @map("wsjf_score") @db.Decimal(10, 2)
  valorNegocio       Int?                 @default(0) @map("valor_negocio")
  reducaoRisco       Int?                 @default(0) @map("reducao_risco")
  oportunidadeTempo  Int?                 @default(0) @map("oportunidade_tempo")
  tamanhoJob         Int?                 @default(0) @map("tamanho_job")
  ownerId            Int?                 @map("owner_id")
  createdAt          DateTime?            @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt          DateTime?            @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  epic               Epic?                @relation(fields: [epicId], references: [id], onUpdate: Restrict, map: "fk_feature_epic")
  pi                 ProgramIncrement     @relation(fields: [piId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_feature_pi")
  piObjectives       PiObjectiveFeature[]
  riscos             Risco[]
  roadmapItens       RoadmapItem[]
  userStories        UserStory[]

  @@index([epicId], map: "idx_epic")
  @@index([piId], map: "idx_pi")
  @@index([status], map: "idx_status")
  @@map("features")
}

model Dependencia {
  id                Int                 @id @default(autoincrement())
  tipoOrigem        DependenciaEntidade @map("tipo_origem")
  entidadeOrigemId  Int                 @map("entidade_origem_id")
  tipoDestino       DependenciaEntidade @map("tipo_destino")
  entidadeDestinoId Int                 @map("entidade_destino_id")
  tipoDependencia   DependenciaTipo?    @default(finish_to_start) @map("tipo_dependencia")
  status            DependenciaStatus?  @default(identificada)
  criticidade       Criticidade?        @default(media)
  descricao         String?             @db.Text
  projetoOrigemId   Int?                @map("projeto_origem_id")
  projetoDestinoId  Int?                @map("projeto_destino_id")
  piId              Int?                @map("pi_id")
  criadoPor         Int?                @map("criado_por")
  createdAt         DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt         DateTime?           @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  pi                ProgramIncrement?   @relation(fields: [piId], references: [id], onUpdate: Restrict, map: "fk_dep_pi")

  @@index([tipoOrigem, entidadeOrigemId], map: "idx_origem")
  @@index([tipoDestino, entidadeDestinoId], map: "idx_destino")
  @@index([status], map: "idx_status")
  @@index([piId], map: "idx_pi")
  @@map("dependencias")
}

model Risco {
  id                Int               @id @default(autoincrement())
  titulo            String            @db.VarChar(255)
  descricao         String            @db.Text
  tipo              RiscoTipo?        @default(risco)
  categoria         String?           @db.VarChar(100)
  probabilidade     Probabilidade?    @default(media)
  impacto           Impacto?          @default(medio)
  scoreRisco        Int?              @map("score_risco")
  planoMitigacao    String?           @map("plano_mitigacao") @db.Text
  planoContingencia String?           @map("plano_contingencia") @db.Text
  status            RiscoStatus?      @default(identificado)
  projetoId         Int?              @map("projeto_id")
  piId              Int?              @map("pi_id")
  featureId         Int?              @map("feature_id")
  ownerId           Int?              @map("owner_id")
  identificadoPor   Int?              @map("identificado_por")
  dataIdentificacao DateTime?         @map("data_identificacao") @db.Date
  dataLimite        DateTime?         @map("data_limite") @db.Date
  createdAt         DateTime?         @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt         DateTime?         @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  feature           Feature?          @relation(fields: [featureId], references: [id], onUpdate: Restrict, map: "fk_risco_feature")
  pi                ProgramIncrement? @relation(fields: [piId], references: [id], onUpdate: Restrict, map: "fk_risco_pi")
  projeto           Projeto?          @relation(fields: [projetoId], references: [id], onUpdate: Restrict, map: "fk_risco_projeto")

  @@index([tipo], map: "idx_tipo")
  @@index([status], map: "idx_status")
  @@index([scoreRisco], map: "idx_score")
  @@index([projetoId], map: "idx_projeto")
  @@index([piId], map: "idx_pi")
  @@index([featureId], map: "idx_feature")
  @@map("riscos")
}

model Roadmap {
  id           Int                  @id @default(autoincrement())
  nome         String               @db.VarChar(100)
  descricao    String?              @db.Text
  artId        Int?                 @map("art_id")
  tipo         RoadmapTipo?         @default(program)
  visibilidade RoadmapVisibilidade? @default(privado)
  createdBy    Int?                 @map("created_by")
  createdAt    DateTime?            @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime?            @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  itens        RoadmapItem[]
  art          Art?                 @relation(fields: [artId], references: [id], onUpdate: Restrict, map: "fk_roadmap_art")

  @@index([artId], map: "idx_art")
  @@map("roadmaps")
}

model RoadmapItem {
  id          Int               @id @default(autoincrement())
  roadmapId   Int               @map("roadmap_id")
  featureId   Int?              @map("feature_id")
  epicId      Int?              @map("epic_id")
  piInicio    Int?              @map("pi_inicio")
  piFim       Int?              @map("pi_fim")
  milestone   String?           @db.VarChar(100)
  cor         String?           @default("#3b82f6") @db.VarChar(7)
  ordem       Int?              @default(0)
  epic        Epic?             @relation(fields: [epicId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ri_epic")
  feature     Feature?          @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ri_feature")
  piFimRef    ProgramIncrement? @relation("RoadmapItemFim", fields: [piFim], references: [id], onUpdate: Restrict, map: "fk_ri_pi_fim")
  piInicioRef ProgramIncrement? @relation("RoadmapItemInicio", fields: [piInicio], references: [id], onUpdate: Restrict, map: "fk_ri_pi_inicio")
  roadmap     Roadmap           @relation(fields: [roadmapId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ri_roadmap")

  @@index([roadmapId], map: "idx_roadmap")
  @@index([featureId], map: "idx_feature")
  @@index([epicId], map: "idx_epic")
  @@index([piInicio], map: "idx_pi_inicio")
  @@index([piFim], map: "fk_ri_pi_fim")
  @@map("roadmap_itens")
}

model Documento {
  id        Int               @id @default(autoincrement())
  titulo    String            @db.VarChar(255)
  icone     String            @db.VarChar(10)
  conteudo  String?           @db.LongText
  parentId  Int?              @map("parent_id")
  ordem     Int               @default(0)
  projetoId Int               @map("projeto_id")
  createdBy Int               @map("created_by")
  createdAt DateTime?         @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt DateTime?         @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  versoes   DocumentoVersao[]
  parent    Documento?        @relation("DocumentoHierarchy", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_doc_parent")
  children  Documento[]       @relation("DocumentoHierarchy")
  projeto   Projeto           @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_doc_projeto")

  @@index([projetoId], map: "idx_projeto")
  @@index([parentId], map: "idx_parent")
  @@index([createdBy], map: "idx_created_by")
  @@index([ordem], map: "idx_ordem")
  @@map("documentos")
}

model DocumentoVersao {
  id               Int       @id @default(autoincrement())
  documentoId      Int       @map("documento_id")
  versao           Int       @default(1)
  conteudo         String    @db.LongText
  usuarioId        Int       @map("usuario_id")
  comentario       String?   @db.Text
  hashConteudo     String?   @map("hash_conteudo") @db.Char(64)
  createdAt        DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  alteracoesResumo String?   @map("alteracoes_resumo") @db.Text
  tamanhoBytes     Int?      @map("tamanho_bytes")
  documento        Documento @relation(fields: [documentoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_doc_versao")

  @@index([documentoId], map: "idx_documento")
  @@index([versao], map: "idx_versao")
  @@index([createdAt], map: "idx_created_at")
  @@map("documento_versoes")
}

model Atividade {
  id               Int                    @id @default(autoincrement())
  tipo             AtividadeTipo
  entidade         AtividadeEntidade
  entidadeId       Int                    @map("entidade_id")
  usuarioId        Int                    @map("usuario_id")
  projetoId        Int                    @map("projeto_id")
  descricao        String?                @db.Text
  metadata         String?                @db.LongText
  createdAt        DateTime?              @default(now()) @map("created_at") @db.DateTime(0)
  visibilidade     AtividadeVisibilidade? @default(projeto)
  totalLikes       Int?                   @default(0) @map("total_likes")
  totalComentarios Int?                   @default(0) @map("total_comentarios")
  editado          Boolean?               @default(false)
  editadoEm        DateTime?              @map("editado_em") @db.DateTime(0)
  comentarios      AtividadeComentario[]
  likes            AtividadeLike[]
  projeto          Projeto                @relation(fields: [projetoId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_atividade_projeto")

  @@index([entidade, entidadeId], map: "idx_entidade")
  @@index([usuarioId], map: "idx_usuario")
  @@index([projetoId], map: "idx_projeto")
  @@index([createdAt], map: "idx_created_at")
  @@index([projetoId, createdAt], map: "idx_projeto_created")
  @@index([visibilidade, createdAt], map: "idx_visibilidade_created")
  @@map("atividades")
}

model AtividadeLike {
  id          Int       @id @default(autoincrement())
  atividadeId Int       @map("atividade_id")
  usuarioId   Int       @map("usuario_id")
  createdAt   DateTime? @default(now()) @map("created_at") @db.DateTime(0)
  atividade   Atividade @relation(fields: [atividadeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_like_atividade")

  @@unique([atividadeId, usuarioId], map: "uniq_atividade_usuario")
  @@index([atividadeId], map: "idx_atividade")
  @@index([usuarioId], map: "idx_usuario")
  @@index([createdAt], map: "idx_created")
  @@map("atividade_likes")
}

model AtividadeComentario {
  id          Int                   @id @default(autoincrement())
  atividadeId Int                   @map("atividade_id")
  usuarioId   Int                   @map("usuario_id")
  texto       String                @db.Text
  parentId    Int?                  @map("parent_id")
  totalLikes  Int?                  @default(0) @map("total_likes")
  editado     Boolean?              @default(false)
  editadoEm   DateTime?             @map("editado_em") @db.DateTime(0)
  createdAt   DateTime?             @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt   DateTime?             @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  atividade   Atividade             @relation(fields: [atividadeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_coment_atividade")
  parent      AtividadeComentario?  @relation("ComentarioThread", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_coment_parent")
  respostas   AtividadeComentario[] @relation("ComentarioThread")
  likes       ComentarioLike[]

  @@index([atividadeId], map: "idx_atividade")
  @@index([usuarioId], map: "idx_usuario")
  @@index([parentId], map: "idx_parent")
  @@index([createdAt], map: "idx_created")
  @@index([atividadeId, createdAt], map: "idx_atividade_created")
  @@map("atividade_comentarios")
}

model ComentarioLike {
  id           Int                 @id @default(autoincrement())
  comentarioId Int                 @map("comentario_id")
  usuarioId    Int                 @map("usuario_id")
  createdAt    DateTime?           @default(now()) @map("created_at") @db.DateTime(0)
  comentario   AtividadeComentario @relation(fields: [comentarioId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_clike_comentario")

  @@unique([comentarioId, usuarioId], map: "uniq_comentario_usuario")
  @@index([comentarioId], map: "idx_comentario")
  @@index([usuarioId], map: "idx_usuario")
  @@map("comentario_likes")
}

enum ProjetoStatus {
  ativo
  pausado
  concluido
  cancelado
}

enum ProjetoMemberRole {
  owner
  admin
  member
  viewer
}

enum TarefaPrioridade {
  baixa
  media
  alta
}

enum UserStoryStatus {
  backlog
  in_progress
  done
}

enum SprintStatus {
  planejamento
  ativo
  concluido
  cancelado
}

enum DodNivel {
  story
  tarefa
  sprint
}

enum RetrospectivaStatus {
  agendada
  em_andamento
  concluida
}

enum RetrospectivaCategoria {
  start
  stop
  continue
  mad
  sad
  glad
  liked
  learned
  lacked
  longed
  outros
}

enum RetrospectivaAcaoStatus {
  pendente
  em_andamento
  concluida
  cancelada
}

enum ArtStatus {
  ativo
  pausado
  inativo
}

enum PiStatus {
  planejamento
  ativo
  concluido
  cancelado
}

enum PiObjectiveType {
  committed
  uncommitted
}

enum PiObjectiveStatus {
  planned
  in_progress
  achieved
  partially_achieved
  not_achieved
}

enum InspectAdaptStatus {
  agendada
  em_andamento
  concluida
}

enum FishboneCategoria {
  people
  process
  tools
  environment
  other
}

enum IaAcaoStatus {
  pendente
  em_andamento
  concluida
  cancelada
}

enum EpicType {
  business
  enabler
  portfolio
}

enum EpicStatus {
  funnel
  review
  analysis
  backlog
  implementing
  done
  cancelled
}

enum FeatureStatus {
  backlog
  analysis
  ready
  implementing
  validating
  done
  cancelled
}

enum DependenciaEntidade {
  epic
  feature
  story
  tarefa
}

enum DependenciaTipo {
  finish_to_start
  start_to_start
  finish_to_finish
  start_to_finish
}

enum DependenciaStatus {
  identificada
  resolvida
  bloqueando
  removida
}

enum Criticidade {
  baixa
  media
  alta
  critica
}

enum RiscoTipo {
  risco
  impedimento
  issue
}

enum Probabilidade {
  muito_baixa
  baixa
  media
  alta
  muito_alta
}

enum Impacto {
  muito_baixo
  baixo
  medio
  alto
  muito_alto
}

enum RiscoStatus {
  identificado
  analisado
  mitigado
  aceito
  resolvido
  ocorrido
}

enum RoadmapTipo {
  solution
  program
  portfolio
}

enum RoadmapVisibilidade {
  publico
  privado
  restrito
}

enum AtividadeTipo {
  create
  update
  delete
  move
  assign
  comment
}

enum AtividadeEntidade {
  tarefa
  coluna
  projeto
  user_story
  documento
}

enum AtividadeVisibilidade {
  publica
  projeto
  privada
}
